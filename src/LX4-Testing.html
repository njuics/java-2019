<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>æ³¨è§£ Annotation</title>
</head>

<body>

    <div class="reveal">
        <div class="slides">

            <section class="title-slide">
                <div class="huge framed bordered border-3x font-passionone bg-warning-alpha-08">
                    æ³¨è§£ Annotation
                </div>
            </section>


            <section>
                <div class="down-3">
                    <h2>æ³¨è§£</h2>
                </div>
                <div class="down-9">
                    <ul>
                        <li>
                            ä»JavaSE 1.5å¼€å§‹ï¼ŒJavaå¢åŠ äº†å¯¹å…ƒæ•°æ®çš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯Annotation
                        </li>
                        <li>
                            Annotationå…¶å®å°±æ˜¯å¯¹ä»£ç çš„ä¸€ç§ç‰¹æ®Šæ ‡è®°ï¼Œè¿™äº›æ ‡è®°å¯ä»¥åœ¨ç¼–è¯‘ï¼Œç±»åŠ è½½å’Œè¿è¡Œæ—¶è¢«è¯»å–ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„å¤„ç†
                        </li>
                    </ul>
                </div>
                <div class="down-3">
                    å…ƒæ•°æ®æ˜¯å…³äºæ•°æ®çš„æ•°æ®ã€‚åœ¨ç¼–ç¨‹è¯­è¨€ä¸Šä¸‹æ–‡ä¸­ï¼Œå…ƒæ•°æ®æ˜¯æ·»åŠ åˆ°ç¨‹åºå…ƒç´ å¦‚æ–¹æ³•ã€å­—æ®µã€ç±»å’ŒåŒ…ä¸Šçš„é¢å¤–ä¿¡æ¯ï¼Œå¯¹æ•°æ®è¿›è¡Œè¯´æ˜æè¿°çš„æ•°æ®
                </div>

            </section>

            <section>
                <div class="down-3">
                    <h2>å¤šè¿›ç¨‹ã€å¤šçº¿ç¨‹</h2>
                </div>
                <div class="down-9">
                    <div class="down-1 ">
                        å¤šè¿›ç¨‹æ“ä½œçš„æ„ä¹‰åœ¨äºå¤šä¸ªè®¡ç®—ä»»åŠ¡è½®æµå…±äº«CPUçš„æ—¶é—´ç‰‡(é’ˆå¯¹å•å¤„ç†å™¨æƒ…å½¢ï¼Œå¤šå¤„ç†å™¨å¯ç†è§£ä¸ºå¹¶è¡Œ)å¹¶å‘æ‰§è¡Œã€‚
                    </div>
                    <div class="down-1 ">
                        æ¯ä¸ªè®¡ç®—ä»»åŠ¡ï¼ˆè¿›ç¨‹ï¼‰å†…åˆå¯ä»¥å­˜åœ¨å¤šä¸ªçº¿ç¨‹ï¼ˆæŒ‡ä»¤æ‰§è¡Œåºåˆ—ï¼‰ã€‚
                    </div>
                </div>
            </section>

            <section>

                <div class="down-3">
                    <h2>å¹¶å‘ vs. å¹¶è¡Œ</h2>
                </div>
                <div class="down-1 center">
                    <div class="center down-1">
                        <img
                            src="http://images.cnitblog.com/blog/94031/201307/01001508-e1a4c7ed78274ec4aa325b928af044e5.png" />
                    </div>
            </section>

            <section>
                <div class="down-3">
                    <h2>å¤šçº¿ç¨‹ä¼˜åŠ¿</h2>
                </div>
                <div class="down-9">
                    <div class="down-1 ">
                        å¤šçº¿ç¨‹çš„å¹¶å‘æ“ä½œä¼˜åŠ¿åœ¨äºï¼Œå½“ç¨‹åºçš„æŸä¸ªä»»åŠ¡å› å¤–éƒ¨æ¡ä»¶é—®é¢˜ï¼Œå¯¼è‡´é˜»å¡ï¼Œå¦‚æœæ²¡æœ‰å¹¶å‘ï¼Œåˆ™æ•´ä¸ªç¨‹åºåœæ­¢ï¼Œç›´åˆ°å¤–éƒ¨æ¡ä»¶å‘ç”Ÿå˜åŒ–ï¼Œä½¿ç”¨å¹¶å‘åï¼Œç¨‹åºä¸­çš„å…¶ä»–ä»»åŠ¡è¿˜å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚
                        <div class="down-1 ">
                            å¦‚æœæ²¡æœ‰é˜»å¡ï¼Œåœ¨å•å¤„ç†å™¨ä¸Šè€ƒè™‘å¤šçº¿ç¨‹å¹¶å‘ä¹Ÿå°±æ²¡æœ‰æ„ä¹‰äº†ï¼Œçº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢ä¼šé€ æˆå¤§é‡çš„æ—¶é—´æ¶ˆè€—ã€‚
                        </div>
                    </div>
            </section>

            <section>
                <div class="down-3">
                    <h2>JVM Threads</h2>
                </div>
                <div class="down-5 center">
                    <div class="center down-1">
                        <img src="https://equinoxrar.files.wordpress.com/2014/08/threads1.png" />
                    </div>
            </section>


            <section>
                <div class="down-30 center larger">
                    åŸºç¡€ç¯‡ </div>
            </section>



            <section>
                <div class="down-3">
                    <h2>Runnableæ¥å£å®šä¹‰â€œä»»åŠ¡â€</h2>
                </div>
                <div class="down-1">
                    <pre class="java tiny">
                        <code data-trim>
                            ublic class LiftOff implements Runnable {
                                protected int countDown = 10; // Default
                                private static int taskCount = 0;
                                private final int id = taskCount++;
                            
                                public LiftOff() {
                                }
                            
                                public LiftOff(int countDown) {
                                    this.countDown = countDown;
                                }
                            
                                public String status() {
                                    return "#" + id + "(" +
                                            (countDown > 0 ? countDown : "Liftoff!") + "), ";
                                }
                            
                                public void run() {
                                    while (countDown-- > 0) {
                                        System.out.print(status());
                                        Thread.yield(); //åé¢è§£é‡Š
                                    }
                                }
                            }
                            
                            public class MainThread {
                                public static void main(String[] args) {
                                    LiftOff launch = new LiftOff();
                                    launch.run();
                                }
                            }
                        </code>
                        
                    </pre>
                </div>
            </section>

            <section>
                <div class="down-3">
                    <h2>Thread</h2>
                </div>
                <div class="down-5">
                    <code> java.lang.Thread</code>

                </div>
                <div class="down-3">
                    <pre class="java">
                            <code data-trim>
                                public class BasicThreads {
                                    public static void main(String[] args) {
                                        //æŠŠä»»åŠ¡è£…è¿›çº¿ç¨‹é‡Œ
                                        Thread t = new Thread(new LiftOff());
                                        t.start();
                                        System.out.println("Waiting for LiftOff");
                                    }
                                }
                            </code>
                            
                        </pre>
                </div>
                <div class="down-1">Threadå¯¹è±¡åƒæ˜¯è¿è½½ç«ç®­ï¼ŒRunnableçš„å®ç°å¯¹è±¡å°±æ˜¯ä¸€ä¸ªè·è½½ï¼ˆpayloadï¼‰</div>
            </section>

            <section>
                <div class="down-3">
                    <h2>æˆ–è€…</h2>
                </div>
                <div class="down-3">
                    <pre class="java tiny">
                        <code data-trim> 
                            public class SimpleThread extends Thread {
                                private int countDown = 5;
                                private static int threadCount = 0;
                            
                                public SimpleThread() {
                                    // Store the thread name:
                                    super(Integer.toString(++threadCount));
                                    start();
                                }
                            
                                public String toString() {
                                    return "#" + getName() + "(" + countDown + "), ";
                                }
                            
                                public void run() {
                                    while (true) {
                                        System.out.print(this);
                                        if (--countDown == 0)
                                            return;
                                    }
                                }
                            
                                public static void main(String[] args) {
                                    for (int i = 0; i &lt; 5; i++)
                                        new SimpleThread();
                                }
                            }
                        </code>
                        
                    </pre>
                </div>
                <div class="down-1 fragment small center">å®é™…ä¸Š<code>public class Thread implements Runnable</code></div>
            </section>

            <section>
                <div class="down-3">
                    <h2>å¤šçº¿ç¨‹ï¼Œèµ°èµ·</h2>
                </div>
                <div class="down-9">
                    <pre class="java">
                                    <code data-trim>
                                        public class MoreBasicThreads {
                                            public static void main(String[] args) {
                                                for (int i = 0; i < 5; i++)
                                                    new Thread(new LiftOff()).start();
                                                System.out.println("Waiting for LiftOff");
                                            }
                                        }
                                    </code>
                                    
                                </pre>
                </div>

                <div class="down-5 center">
                    ç›´æ¥å¯åŠ¨å¤šä¸ª<code>Thread</code></div>
            </section>

            <section>
                <div class="down-3">
                    <h2>æˆ–è€…ç”¨ExecutorServiceå¯åŠ¨</h2>
                </div>
                <div class="down-3">
                    <pre class="java">
                        <code data-trim>
                            public class CachedThreadPool {
                                public static void main(String[] args) {
                                    ExecutorService exec = Executors.newCachedThreadPool();
                                    for (int i = 0; i < 5; i++)
                                        exec.execute(new LiftOff());
                                    exec.shutdown();
                                }
                            }
                        </code>
                        
                    </pre>
                </div>

                <div class="down-1  center">
                    <code>CachedThreadPool</code>æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œå¦‚æœç°æœ‰çº¿ç¨‹æ²¡æœ‰å¯ç”¨çš„ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹å¹¶æ·»åŠ åˆ°æ± ä¸­ï¼Œå¦‚æœæœ‰è¢«ä½¿ç”¨å®Œä½†æ˜¯è¿˜æ²¡é”€æ¯çš„çº¿ç¨‹ï¼Œå°±å¤ç”¨è¯¥çº¿ç¨‹
                </div>
            </section>
            <section>
                <div class="down-3">
                    <h2>çº¿ç¨‹æ± ï¼Ÿ</h2>
                </div>
                <div class="down-9">
                    <ul>
                        <li>
                            åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œåˆ›å»ºå’Œé”€æ¯å¯¹è±¡æ˜¯å¾ˆè´¹æ—¶é—´çš„ï¼Œå› ä¸ºåˆ›å»ºä¸€ä¸ªå¯¹è±¡è¦è·å–å†…å­˜èµ„æºæˆ–è€…å…¶å®ƒæ›´å¤šèµ„æºã€‚
                        </li>
                        <li>
                            åœ¨Javaä¸­æ›´æ˜¯å¦‚æ­¤ï¼Œè™šæ‹Ÿæœºå°†è¯•å›¾è·Ÿè¸ªæ¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»¥ä¾¿èƒ½å¤Ÿåœ¨å¯¹è±¡é”€æ¯åè¿›è¡Œåƒåœ¾å›æ”¶ã€‚
                        </li>
                        <li>
                            æ‰€ä»¥æé«˜æœåŠ¡ç¨‹åºæ•ˆç‡çš„ä¸€ä¸ªæ‰‹æ®µå°±æ˜¯å°½å¯èƒ½å‡å°‘åˆ›å»ºå’Œé”€æ¯å¯¹è±¡çš„æ¬¡æ•°ï¼Œç‰¹åˆ«æ˜¯ä¸€äº›å¾ˆè€—èµ„æºçš„å¯¹è±¡åˆ›å»ºå’Œé”€æ¯ã€‚
                        </li>
                        <li>
                            å¦‚ä½•åˆ©ç”¨å·²æœ‰å¯¹è±¡æ¥æœåŠ¡å°±æ˜¯ä¸€ä¸ªéœ€è¦è§£å†³çš„å…³é”®é—®é¢˜ï¼Œå…¶å®è¿™å°±æ˜¯ä¸€äº›"æ± åŒ–èµ„æº"æŠ€æœ¯äº§ç”Ÿçš„åŸå› ã€‚
                        </li>
                    </ul>

                </div>
            </section>
            <section>
                <div class="down-3">
                    <h2>æˆ–è€…å¦ä¸€ç§ç­–ç•¥</h2>
                </div>
                <div class="down-3">
                    <pre class="java">
                        <code data-trim>
                                public class FixedThreadPool {
                                    public static void main(String[] args) {
                                        // Constructor argument is number of threads:
                                        ExecutorService exec = Executors.newFixedThreadPool(5);
                                        for (int i = 0; i < 5; i++)
                                            exec.execute(new LiftOff());
                                        exec.shutdown();
                                    }
                                }
                        </code>
                        
                    </pre>
                </div>

                <div class="down-1 small center">
                    åˆ›å»ºä¸€ä¸ªå›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ï¼Œåœ¨ä»»ä½•æ—¶å€™æœ€å¤šåªæœ‰nä¸ªçº¿ç¨‹è¢«åˆ›å»ºã€‚å¦‚æœåœ¨æ‰€æœ‰çº¿ç¨‹éƒ½å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶ï¼Œæœ‰å…¶ä»–ä»»åŠ¡æäº¤ï¼Œä»–ä»¬å°†ç­‰å¾…é˜Ÿåˆ—ä¸­ç›´åˆ°çº¿ç¨‹å¯ç”¨ã€‚å¦‚æœä»»ä½•çº¿ç¨‹ç”±äºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ•…éšœè€Œç»ˆæ­¢ï¼Œå°†ä¼šæœ‰ä¸€ä¸ªæ–°çº¿ç¨‹å°†å–ä»£è¿™ä¸ªçº¿ç¨‹æ‰§è¡Œåç»­ä»»åŠ¡ã€‚
                </div>
                <div class="down-1 small danger fragment center">å¦‚æœéœ€è¦è·å¾—å¼‚æ­¥æ‰§è¡Œçš„ä»»åŠ¡çš„ç»“æœæ€ä¹ˆåŠï¼Ÿ
                </div>
            </section>

            <section>
                <div class="down-1">
                    <h2> Callable</h2>
                </div>
                <div class="down-1">
                    <pre class="java tiny">
                                        <code data-trim>
                                                public interface Callable&lt;V&gt; {
                                                    V call() throws Exception;
                                                }
                                                class TaskWithResult implements Callable&lt;String&gt; {
                                                    private int id;
                                                
                                                    public TaskWithResult(int id) {
                                                        this.id = id;
                                                    }
                                                
                                                    public String call() {
                                                        return "result of TaskWithResult " + id;
                                                    }
                                                }
                                                
                                                public class CallableDemo {
                                                    public static void main(String[] args) {
                                                        ExecutorService exec = Executors.newCachedThreadPool();
                                                        ArrayList&lt;Future&lt;String&gt;&gt; results =
                                                                new ArrayList&lt;Future&lt;String&gt;&gt;();
                                                        for (int i = 0; i &lt; 10; i++)
                                                            results.add(exec.submit(new TaskWithResult(i)));
                                                        for (Future&lt;String&gt; fs : results)
                                                            try {
                                                                // get() blocks until completion:
                                                                System.out.println(fs.get());
                                                            } catch (InterruptedException e) {
                                                                System.out.println(e);
                                                                return;
                                                            } catch (ExecutionException e) {
                                                                System.out.println(e);
                                                            } finally {
                                                                exec.shutdown();
                                                            }
                                                    }
                                                }
                                        </code>
                                        
                                    </pre>
                </div>
            </section>
            <section>
                <div class="down-3">
                    <h2> Future </h2>
                </div>
                <div class="down-1">
                    <pre class="java">
                                                <code data-trim>
                                                        class MyCallable implements Callable&lt;String&gt;{
                                                                @Override
                                                                public String call() throws Exception {
                                                                    System.out.println("åšä¸€äº›è€—æ—¶çš„ä»»åŠ¡...");
                                                                    Thread.sleep(5000);
                                                                    return "OK";
                                                                }
                                                            }
                                                            
                                                            public class FutureSimpleDemo {
                                                                public static void main(String[] args) throws InterruptedException, ExecutionException {
                                                                    ExecutorService executorService = Executors.newCachedThreadPool();
                                                                    Future&lt;String&gt; future = executorService.submit(new MyCallable());
                                                            
                                                                    System.out.println("dosomething...");
                                                                    System.out.println("å¾—åˆ°å¼‚æ­¥ä»»åŠ¡è¿”å›ç»“æœï¼š" + future.get());
                                                                    System.out.println("Completed!");
                                                                }
                                                            }
                                                </code>
                                            </pre>
                </div>
                <div class=" fragment danger center small">
                    å½“è°ƒç”¨<code>future.get()</code>æ–¹æ³•ä»¥è·å¾—ç»“æœæ—¶ï¼Œå½“å‰çº¿ç¨‹å°±å¼€å§‹é˜»å¡ï¼Œç›´æ¥<code>call()</code>æ–¹æ³•ç»“æŸè¿”å›ç»“æœã€‚</div>
            </section>

            <section>
                <div class="down-3">
                    <h2> SLEEP </h2>
                </div>
                <div class="down-1">
                    <pre class="java">
                        <code data-trim>
                                public class SleepingTask extends LiftOff {
                                    public void run() {
                                        try {
                                            while (countDown-- > 0) {
                                                System.out.print(status());
                                                // Old-style: Thread.sleep(100);
                                                TimeUnit.MILLISECONDS.sleep(100);
                                            }
                                        } catch (InterruptedException e) {
                                            System.err.println("Interrupted");  //å¯èƒ½è¢«æ‰“æ–­
                                        }
                                    }
                                    public static void main(String[] args) {
                                        ExecutorService exec = Executors.newCachedThreadPool();
                                        for (int i = 0; i &lt; 5; i++)
                                            exec.execute(new SleepingTask());
                                        exec.shutdown();
                                    }
                                }
                        </code>                 
                    </pre>
                </div>

                <div class="center small">
                    è¿è¡Œç»“æœçœ‹èµ·æ¥åº”è¯¥å¹³ç¨³ï¼Œä½†å®é™…å¹¶ä¸å®Œå…¨å¦‚æ­¤... </div>
            </section>

            <section>
                <div class="down-3">
                    <h2> Yeild è®©ä½  </h2>
                </div>
                <!-- <div class="down-5">
                    <code>yield</code>å’Œ<code>sleep</code>çš„ä¸»è¦åŒºåˆ«æ˜¯
                </div> -->
                <div class="down-9">
                    <ul>
                        <li>
                            yieldæ–¹æ³•ä¼šä¸´æ—¶æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œæ¥è®©æœ‰åŒæ ·ä¼˜å…ˆçº§çš„æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹æœ‰æœºä¼šæ‰§è¡Œ </li>
                        <li>
                            å¦‚æœæ²¡æœ‰æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹ï¼Œæˆ–è€…æ‰€æœ‰æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹çš„ä¼˜å…ˆçº§éƒ½æ¯”è¾ƒä½ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šç»§ç»­è¿è¡Œ </li>
                        <li>
                            æ‰§è¡Œäº†yieldæ–¹æ³•çš„çº¿ç¨‹ä»€ä¹ˆæ—¶å€™ä¼šç»§ç»­è¿è¡Œç”±çº¿ç¨‹è°ƒåº¦å™¨æ¥å†³å®šï¼Œä¸åŒçš„å‚å•†å¯èƒ½æœ‰ä¸åŒçš„è¡Œä¸º </li>
                        <li>
                            yieldæ–¹æ³•ä¸ä¿è¯å½“å‰çš„çº¿ç¨‹ä¼šæš‚åœæˆ–è€…åœæ­¢ï¼Œä½†æ˜¯å¯ä»¥ä¿è¯å½“å‰çº¿ç¨‹åœ¨è°ƒç”¨yieldæ–¹æ³•æ—¶ä¼šæ”¾å¼ƒCPUã€‚ </li>
                    </ul>

                </div>
            </section>

            <section>
                <div class="down-1">
                    <h2> Priority </h2>
                </div>
                <div>
                    <pre class="java tiny">
                            <code data-trim>
                                    public class SimplePriorities implements Runnable {
                                        private int countDown = 5;
                                        private volatile double d; // No optimization åé¢å†è§£é‡Š
                                        private int priority;
                                    
                                        public SimplePriorities(int priority) {
                                            this.priority = priority;
                                        }
                                    
                                        public String toString() {
                                            return Thread.currentThread() + ": " + countDown;
                                        }
                                    
                                        public void run() {
                                            Thread.currentThread().setPriority(priority);
                                            while (true) {
                                                // An expensive, interruptable operation:
                                                for (int i = 1; i &lg; 100000; i++) {
                                                    d += (Math.PI + Math.E) / (double) i;
                                                    if (i % 1000 == 0)
                                                        Thread.yield();
                                                }
                                                System.out.println(this);
                                                if (--countDown == 0) return;
                                            }
                                        }
                                    
                                        public static void main(String[] args) {
                                            ExecutorService exec = Executors.newCachedThreadPool();
                                            for (int i = 0; i &lg; 5; i++)
                                                exec.execute(
                                                        new SimplePriorities(Thread.MIN_PRIORITY));
                                            exec.execute(
                                                    new SimplePriorities(Thread.MAX_PRIORITY));
                                            exec.shutdown();
                                        }
                                    }
                            </code>
                            
                        </pre>
                </div>
            </section>
            <section>
                <div class="down-3">
                    <h2> Deamon çº¿ç¨‹ </h2>
                </div>
                <div class="">
                    <pre class="java">
                                <code data-trim>
                                        public class SimpleDaemons implements Runnable {
                                            public void run() {
                                                try {
                                                    while (true) {
                                                        TimeUnit.MILLISECONDS.sleep(100);
                                                        print(Thread.currentThread() + " " + this);
                                                    }
                                                } catch (InterruptedException e) {
                                                    print("sleep() interrupted");
                                                }
                                            }
                                            public static void main(String[] args) throws Exception {
                                                for (int i = 0; i &lt; 10; i++) {
                                                    Thread daemon = new Thread(new SimpleDaemons());
                                                    daemon.setDaemon(true); // Must call before start()
                                                    daemon.start();
                                                }
                                                print("All daemons started");
                                                TimeUnit.MILLISECONDS.sleep(99);
                                            }
                                        }
                                </code>                   
                            </pre>
                </div>
                <div class="smaller danger center">
                    åå°è¿è¡Œçº¿ç¨‹ï¼Œå½“æ‰€æœ‰éåå°çº¿ç¨‹ç»“æŸæ—¶ï¼Œåº”ç”¨é€€å‡ºï¼Œæ‰€æœ‰Deamonçº¿ç¨‹è¢«æ€ğŸ˜¢
                </div>
            </section>

            <section>
                <div class="down-3">
                    <h2>å°ç»“ä¸€ä¸‹ </h2>
                </div>

                <div class="down-5">
                    Javaå…³äºçº¿ç¨‹ç¼–ç¨‹çš„æŠ½è±¡
                </div>
                <div class="down-3">
                    <code>Thread</code>å¯¹è±¡åƒæ˜¯è¿è½½ç«ç®­ï¼Œ<code>Runnable</code>/<code>Callable</code>çš„å®ç°å¯¹è±¡å°±æ˜¯ä¸€ä¸ªè·è½½ï¼ˆpayloadï¼‰

                </div>

                <div class="down-5  large danger center">
                    Runnable/Callable --> Task
                </div>
                <div class="down-1  large danger center">
                    Thread --> let tasks go </div>
            </section>



            <section>
                <div class="down-30 center larger">
                    ä¸­çº§ç¯‡</div>
            </section>


            <section>
                <div class="down-3">
                    <h2>Join </h2>
                </div>
                <div class="row">

                    <div class="col-50">
                        <pre class="java tiny">
                                    <code data-trim>
                                            class Sleeper extends Thread {
                                                private int duration;
                                            
                                                public Sleeper(String name, int sleepTime) {
                                                    super(name);
                                                    duration = sleepTime;
                                                    start();
                                                }
                                            
                                                public void run() {
                                                    try {
                                                        sleep(duration);
                                                    } catch (InterruptedException e) {
                                                        print(getName() + " was interrupted. " +
                                                                "isInterrupted(): " + isInterrupted());
                                                        return;
                                                    }
                                                    print(getName() + " has awakened");
                                                }
                                            }
                                    </code>
                                                                
                                </pre>
                    </div>
                    <div class="col-50">
                        <pre class="java tiny">
                                    <code data-trim>
                                            class Joiner extends Thread {
                                                private Sleeper sleeper;
                                            
                                                public Joiner(String name, Sleeper sleeper) {
                                                    super(name);
                                                    this.sleeper = sleeper;
                                                    start();
                                                }
                                            
                                                public void run() {
                                                    try {
                                                        sleeper.join();
                                                    } catch (InterruptedException e) {
                                                        print("Interrupted");
                                                    }
                                                    print(getName() + " join completed");
                                                }
                                            }
                                            
                                            public class Joining {
                                                public static void main(String[] args) {
                                                    Sleeper
                                                            sleepy = new Sleeper("Sleepy", 1500),
                                                            grumpy = new Sleeper("Grumpy", 1500);
                                                    Joiner
                                                            dopey = new Joiner("Dopey", sleepy),
                                                            doc = new Joiner("Doc", grumpy);
                                                    grumpy.interrupt();
                                                }
                                            }
                                    </code>
                                                                
                                </pre>
                    </div>
                </div>


            </section>

            <section>
                <div class="down-3">
                    <h2> Uncaught Exceptions </h2>
                </div>
                <div class="down-1">
                    <pre class="java">
                            <code data-trim>
                                    public class ExceptionThread implements Runnable {
                                        public void run() {
                                            throw new RuntimeException();
                                        }
                                    
                                        public static void main(String[] args) {
                                            ExecutorService exec = Executors.newCachedThreadPool();
                                            exec.execute(new ExceptionThread());
                                        }
                                    }
                            </code>
                            <code  data-trim>
                                    public class NaiveExceptionHandling {
                                        public static void main(String[] args) {
                                            try {
                                                ExecutorService exec =
                                                        Executors.newCachedThreadPool();
                                                exec.execute(new ExceptionThread());
                                            } catch (RuntimeException ue) {
                                                // This statement will NOT execute!
                                                System.out.println("Exception has been handled!");
                                            }
                                        }
                                    }
                            </code>
                                                        
                        </pre>
                </div>

                <div class="down-1  large danger center">
                    Exception in thread "pool-1-thread-1" java.lang.RuntimeException
                    at concurrency.ExceptionThread.run(ExceptionThread.java:7)
                    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
                    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
                    at java.lang.Thread.run(Thread.java:745)
                </div>
            </section>

            <section>
                <div class="down-3">
                    <h2>UncaughtExceptionHandler</h2>
                </div>
                <div class="row">

                    <div class="col-50">
                        <pre class="java tiny">
                                        <code data-trim>
                                                class ExceptionThread2 implements Runnable {
                                                    public void run() {
                                                        Thread t = Thread.currentThread();
                                                        System.out.println("run() by " + t);
                                                        System.out.println(
                                                                "eh = " + t.getUncaughtExceptionHandler());
                                                        throw new RuntimeException();
                                                    }
                                                }
                                                
                                                class MyUncaughtExceptionHandler implements
                                                        Thread.UncaughtExceptionHandler {
                                                    public void uncaughtException(Thread t, Throwable e) {
                                                        System.out.println("caught " + e);
                                                    }
                                                }
                                        </code>
                                                                    
                                    </pre>
                    </div>
                    <div class="col-50">
                        <pre class="java tiny">
                                        <code data-trim>
                                                class HandlerThreadFactory implements ThreadFactory {
                                                    public Thread newThread(Runnable r) {
                                                        System.out.println(this + " creating new Thread");
                                                        Thread t = new Thread(r);
                                                        System.out.println("created " + t);
                                                        t.setUncaughtExceptionHandler(
                                                                new MyUncaughtExceptionHandler());
                                                        System.out.println(
                                                                "eh = " + t.getUncaughtExceptionHandler());
                                                        return t;
                                                    }
                                                }
                                                
                                                public class CaptureUncaughtException {
                                                    public static void main(String[] args) {
                                                        ExecutorService exec = Executors.newCachedThreadPool(
                                                                new HandlerThreadFactory());
                                                        exec.execute(new ExceptionThread2());
                                                        exec.shutdown();
                                                    }
                                                }
                                        </code>
                                                                    
                                    </pre>
                    </div>
                </div>
            </section>
            <!-- <section>
                <div class="down-3">
                    <h2>æˆ–è€…ç®€å•ä¸€ç‚¹</h2>
                </div>
                <div class="down-1">
                    <pre class="java">
                                <code data-trim>
                                        class HandlerThreadFactory implements ThreadFactory {
                                            public Thread newThread(Runnable r) {
                                                System.out.println(this + " creating new Thread");
                                                Thread t = new Thread(r);
                                                System.out.println("created " + t);
                                                t.setUncaughtExceptionHandler(
                                                        new MyUncaughtExceptionHandler());
                                                System.out.println(
                                                        "eh = " + t.getUncaughtExceptionHandler());
                                                return t;
                                            }
                                        }
                                        
                                        public class CaptureUncaughtException {
                                            public static void main(String[] args) {
                                                ExecutorService exec = Executors.newCachedThreadPool(
                                                        new HandlerThreadFactory());
                                                exec.execute(new ExceptionThread2());
                                                exec.shutdown();
                                            }
                                        }
                                </code>
                                                            
                            </pre>
                </div>

            </section> -->

            <section>
                <div class="down-3">
                    <h2> èµ„æºå…±äº«é—®é¢˜ </h2>
                </div>
                <div class="down-9">
                    ä¸€ä¸ªè‘«èŠ¦å¨ƒåœ¨æˆ˜åœºä¸Šå¯ä»¥éšæ„èµ°ï¼Œå¤šä¸ªè‘«èŠ¦å¨ƒåœ¨æˆ˜åœºä¸Šæ˜¯éšæ„èµ°ï¼Œé‚£å°±ä¼šæ’å¤´ã€‚

                </div>
                <div class="down-5">
                    å› ä¸ºä¸€ä¸ªç©ºé—´ä½ç½®ï¼Œæ˜¯ä¸èƒ½å…±äº«çš„ã€‚
                </div>
            </section>

            <section>
                <div class="down-3">
                    <h2>ç¤ºä¾‹</h2>
                </div>
                <div class="down-1">
                    <pre class="java">
                            <code data-trim>
                                    public abstract class IntGenerator {
                                        private volatile boolean canceled = false;
                                    
                                        public abstract int next();
                                    
                                        // Allow this to be canceled:
                                        public void cancel() {
                                            canceled = true;
                                        }
                                    
                                        public boolean isCanceled() {
                                            return canceled;
                                        }
                                    }
                                    
                                    public class EvenGenerator extends IntGenerator {
                                        private int currentEvenValue = 0;
                                    
                                        public int next() {
                                            ++currentEvenValue; // Danger point here!
                                            Thread.yield();
                                            ++currentEvenValue;
                                            return currentEvenValue;
                                        }
                                    }
                            </code>
                                                        
                        </pre>
                </div>
            </section>
            <section>
                <div class="down-3">
                    <h2>EvenChecker</h2>
                </div>
                <div class="down-1">
                    <pre class="java tiny">
                            <code data-trim>
                                    public class EvenChecker implements Runnable {
                                        private IntGenerator generator;
                                        private final int id;
                                    
                                        public EvenChecker(IntGenerator g, int ident) {
                                            generator = g;
                                            id = ident;
                                        }
                                        public void run() {
                                            while (!generator.isCanceled()) {
                                                int val = generator.next();
                                                if (val % 2 != 0) {
                                                    System.out.println(val + " not even!");
                                                    generator.cancel(); // Cancels all EvenCheckers
                                                }
                                            }
                                        }
                                        // Test any type of IntGenerator:
                                        public static void test(IntGenerator gp, int count) {
                                            System.out.println("Press Control-C to exit");
                                            ExecutorService exec = Executors.newCachedThreadPool();
                                            for (int i = 0; i &lt; count; i++)
                                                exec.execute(new EvenChecker(gp, i));
                                            exec.shutdown();
                                        }
                                        // Default value for count:
                                        public static void test(IntGenerator gp) {
                                            test(gp, 10);
                                        }   
                                        public static void main(String[] args) {
                                            EvenChecker.test(new EvenGenerator());
                                        }
                                    
                                    }
                            </code>
                                                        
                        </pre>
                </div>
            </section>
            <section>
                <div class="down-3">
                    <h2>è§£å†³æ–¹æ³•</h2>
                </div>
                <div class="down-3">
                    å¯¹èµ„æºåŠ é”ï¼Œä½¿å¾—å¯¹èµ„æºçš„è®¿é—®é¡ºåºåŒ–ï¼Œç¡®ä¿åœ¨æŸä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªä»»åŠ¡åœ¨ä½¿ç”¨å…±äº«èµ„æºï¼ˆä½¿å…¶äº’æ–¥ï¼‰
                </div>
                <div class="down-3 center">
                    Mutual Exclusion ï¼ˆMutexï¼‰

                </div>

            </section>
            <section>
                <div class="down-3">
                    <h2>Synchronized</h2>
                </div>

                <div class="down-9">
                    <pre class="java">
                            <code data-trim>
                                    public class SynchronizedEvenGenerator extends IntGenerator {
                                        private int currentEvenValue = 0;
                                    
                                        public synchronized int next() {
                                            ++currentEvenValue;
                                            Thread.yield(); 
                                            ++currentEvenValue;
                                            return currentEvenValue;
                                        }
                                    
                                        public static void main(String[] args) {
                                            EvenChecker.test(new SynchronizedEvenGenerator());
                                        }
                                    }
                            </code>              
                        </pre>
                </div>
            </section>
            <section>
                <div class="down-3">
                    <h2>Lock</h2>
                </div>

                <div class="down-1">
                    <pre class="java">
                        <code data-trim>
                                public class MutexEvenGenerator extends IntGenerator {
                                    private int currentEvenValue = 0;
                                    private Lock lock = new ReentrantLock();
                                
                                    public int next() {
                                        //åŠ é”
                                        lock.lock();
                                        try {
                                            ++currentEvenValue;
                                            Thread.yield();
                                            ++currentEvenValue;
                                            return currentEvenValue;
                                        } finally {
                                            //ä¸€å®šè¦ç”¨try-catchçš„finallyå»é‡Šæ”¾é”
                                            lock.unlock();
                                        }
                                    }
                                    public static void main(String[] args) {
                                        EvenChecker.test(new MutexEvenGenerator());
                                    }
                                } 
                        </code>              
                    </pre>
                </div>
                <div class="smaller center">

                    <code>ReentrantLock</code>å…è®¸å°è¯•åŠ é”ï¼š<code>lock.tryLock(2, TimeUnit.SECONDS)</code>ï¼Œè‹¥å¤±è´¥åšå…¶ä»–å¤„ç†ã€‚

                </div>

            </section>

            <section>
                <div class="down-3">
                    <h2>Critical Sections ä¸´ç•ŒåŒº</h2>
                </div>
                <div>
                    <pre class="java">
                            <code data-trim>
                                    synchronized(syncObject){
                                        //balabala
                                    }
                            </code>              
                        </pre>
                    <pre class="java">
                            <code data-trim>
                                    class PairManager1 extends PairManager {
                                        public synchronized void increment() {  // Synchronize the entire method
                                            p.incrementX();
                                            p.incrementY();
                                            store(getPair());
                                        }
                                    }
                                    class PairManager2 extends PairManager {
                                        public void increment() {
                                            Pair temp;
                                            synchronized (this) {   // Use a critical section:
                                                p.incrementX();
                                                p.incrementY();
                                                temp = getPair();
                                            }
                                            store(temp);
                                        }
                                    }
                            </code>              
                        </pre>
                </div>

            </section>
            <section>
                <div class="down-3">
                    <h2>Lock on Object</h2>
                </div>

                <div class="center down-1">
                    <img
                        src="http://4.bp.blogspot.com/-kRUcoXzDmAM/T48eQOjNzuI/AAAAAAAAA38/TaU6Eub90uA/s1600/Object-Monitor-Threads.PNG" />

                </div>

            </section>
            <section>

                <div class="down-3">
                    <h2>Thread local Storage</h2>
                </div>

                <div class="center down-1">
                    <img src="https://i.stack.imgur.com/Dhws6.jpg" />

                </div>
            </section>

            <section>
                <div class="down-3">
                    <h2>ç¤ºä¾‹</h2>
                </div>

                <div class="row">

                    <div class="col-50">
                        <pre class="java tiny">
                                            <code data-trim>
                                                    class Accessor implements Runnable {
                                                        private final int id;
                                                    
                                                        public Accessor(int idn) {
                                                            id = idn;
                                                        }
                                                    
                                                        public void run() {
                                                            while (!Thread.currentThread().isInterrupted()) {
                                                                ThreadLocalVariableHolder.increment();
                                                                System.out.println(this);
                                                                Thread.yield();
                                                            }
                                                        }
                                                    
                                                        public String toString() {
                                                            return "#" + id + ": " +
                                                                    ThreadLocalVariableHolder.get();
                                                        }
                                                    }
                                                    
                                            </code>
                                                                        
                                        </pre>
                    </div>
                    <div class="col-50">
                        <pre class="java tiny">
                                            <code data-trim>
                                                    public class ThreadLocalVariableHolder {
                                                        private static ThreadLocal&lt;Integer&gt; value =
                                                                new ThreadLocal&lt;Integer&gt;() {
                                                                    private Random rand = new Random(47);
                                                    
                                                                    protected synchronized Integer initialValue() {
                                                                        return rand.nextInt(10000);
                                                                    }
                                                                };
                                                    
                                                        public static void increment() {
                                                            value.set(value.get() + 1);
                                                        }
                                                    
                                                        public static int get() {
                                                            return value.get();
                                                        }
                                                    
                                                        public static void main(String[] args) throws Exception {
                                                            ExecutorService exec = Executors.newCachedThreadPool();
                                                            for (int i = 0; i &lt; 5; i++)
                                                                exec.execute(new Accessor(i));
                                                            TimeUnit.SECONDS.sleep(3);  // Run for a while
                                                            exec.shutdownNow();         // All Accessors will quit
                                                        }
                                                    }
                                            </code>
                                                                        
                                        </pre>
                    </div>
                </div>
            </section>

            <section>

                <div class="down-3">
                    <h2>ä»ç«äº‰åˆ°åä½œ</h2>
                </div>

                <div class="down-9 center">
                    <pre class="java ">
                            <code data-trim>
                                    wait();
                                    notify();
                                    notifyAll();
                            </code>              
                        </pre>

                    <div class="center down-1">
                        <code>Object</code>ç±»å‹ä¸Šçš„ä¸‰ä¸ªæ–¹æ³•

                    </div>
            </section>

            <section>
                <div class="down-3">
                    <h2>è¿˜æ˜¯çœ‹ä¸ªä¾‹å­</h2>
                </div>
                <div class="row">

                    <div class="col-50">
                        <pre class="java tiny">
                                            <code data-trim>
                                                    class Car {
                                                        private boolean waxOn = false;
                                                    
                                                        public synchronized void waxed() {
                                                            waxOn = true; // Ready to buff
                                                            notifyAll();
                                                        }
                                                    
                                                        public synchronized void buffed() {
                                                            waxOn = false; // Ready for another coat of wax
                                                            notifyAll();
                                                        }
                                                    
                                                        public synchronized void waitForWaxing()
                                                                throws InterruptedException {
                                                            while (waxOn == false)
                                                                wait();
                                                        }
                                                    
                                                        public synchronized void waitForBuffing()
                                                                throws InterruptedException {
                                                            while (waxOn == true)
                                                                wait();
                                                        }
                                                    }
                                            </code>
                                                                        
                                        </pre>
                    </div>
                    <div class="col-50">
                        <pre class="java tiny">
                                            <code data-trim>
                                                    class WaxOn implements Runnable {
                                                        private Car car;
                                                    
                                                        public WaxOn(Car c) {
                                                            car = c;
                                                        }
                                                    
                                                        public void run() {
                                                            try {
                                                                while (!Thread.interrupted()) {
                                                                    printnb("Wax On! ");
                                                                    TimeUnit.MILLISECONDS.sleep(200);
                                                                    car.waxed();
                                                                    car.waitForBuffing();
                                                                }
                                                            } catch (InterruptedException e) {
                                                                print("Exiting via interrupt");
                                                            }
                                                            print("Ending Wax On task");
                                                        }
                                                    }
                                            </code>
                                                                        
                                        </pre>
                    </div>
                </div>

            </section>

            <section>
                <div class="down-3">
                    <h2>æ¥ä¸Šé¡µ</h2>
                </div>
                <div class="row">

                    <div class="col-50">
                        <pre class="java tiny">
                                                <code data-trim>
                                                        class WaxOff implements Runnable {
                                                            private Car car;
                                                        
                                                            public WaxOff(Car c) {
                                                                car = c;
                                                            }
                                                        
                                                            public void run() {
                                                                try {
                                                                    while (!Thread.interrupted()) {
                                                                        car.waitForWaxing();
                                                                        printnb("Wax Off! ");
                                                                        TimeUnit.MILLISECONDS.sleep(200);
                                                                        car.buffed();
                                                                    }
                                                                } catch (InterruptedException e) {
                                                                    print("Exiting via interrupt");
                                                                }
                                                                print("Ending Wax Off task");
                                                            }
                                                        }
                                                </code>
                                                                            
                                            </pre>
                    </div>
                    <div class="col-50">
                        <pre class="java tiny">
                                                <code data-trim>
                                                        public class WaxOMatic {
                                                            public static void main(String[] args) throws Exception {
                                                                Car car = new Car();
                                                                ExecutorService exec = Executors.newCachedThreadPool();
                                                                exec.execute(new WaxOff(car));
                                                                exec.execute(new WaxOn(car));
                                                                TimeUnit.SECONDS.sleep(5); // Run for a while...
                                                                exec.shutdownNow(); // Interrupt all tasks
                                                            }
                                                        }
                                                </code>
                                                                            
                                            </pre>
                    </div>
                </div>
            </section>

            <section>
                <div class="down-3">
                    <h2>çº¿ç¨‹çŠ¶æ€</h2>
                </div>

                <div class="center down-1">
                    <img
                        src="https://www.w3resource.com/w3r_images/java-threadclass-methods-and-threadstates-jimage1.png" />

                </div>
            </section>

            <section>
                <div class="down-3">
                    <h2>waitå’Œsleepçš„åŒºåˆ«</h2>
                </div>
                <div class="down-9">
                    <ul>
                        <li>
                            è°ƒç”¨waitæ–¹æ³•æ—¶ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…çš„æ—¶å€™ä¼šé‡Šæ”¾æ‰å®ƒæ‰€è·å¾—çš„monitorï¼Œä½†æ˜¯è°ƒç”¨Thread.sleep()æ–¹æ³•æ—¶ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…çš„æ—¶å€™ä»ç„¶ä¼šæŒæœ‰monitoræˆ–è€…é”ï¼Œwaitæ–¹æ³•åº”åœ¨åŒæ­¥ä»£ç å—ä¸­è°ƒç”¨ï¼Œä½†æ˜¯sleepæ–¹æ³•ä¸éœ€è¦
                        </li>
                        <li>
                            Thread.sleep()æ–¹æ³•æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œä½œç”¨åœ¨å½“å‰çº¿ç¨‹ä¸Šï¼›ä½†æ˜¯waitæ–¹æ³•æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œå¹¶ä¸”åªèƒ½åœ¨å…¶ä»–çº¿ç¨‹è°ƒç”¨æœ¬å®ä¾‹çš„notify()æ–¹æ³•æ—¶è¢«å”¤é†’ </li>

                    </ul>

                </div>
                <div class=" large danger center">
                    å¦‚æœéœ€è¦æš‚åœçº¿ç¨‹ä¸€æ®µç‰¹å®šçš„æ—¶é—´å°±ä½¿ç”¨sleep()æ–¹æ³•ï¼Œå¦‚æœè¦å®ç°çº¿ç¨‹é—´é€šä¿¡å°±ä½¿ç”¨wait()æ–¹æ³•ã€‚
                </div>
            </section>


            <section>
                <div class="down-30 center larger">
                    é«˜çº§ç¯‡</div>
            </section>


            <section>
                <div class="down-3">
                    <h2>é«˜çº§è®¾æ–½</h2>
                </div>
                <div class="down-9">
                    <ul>
                        <li>
                            CountDownLatch
                        </li>
                        <li>
                            CyclicBarrier </li>
                        <li>
                            DelayQueue
                        </li>
                        <li>
                            PriorityBlockingQueue
                        </li>
                        <li>
                            ScheduledExector
                        </li>
                        <li>
                            Semaphore
                        </li>
                        <li>
                            Exchanger
                        </li>
                    </ul>

                </div>
                <div class=" large center">è¯·çœ‹ä¹¦
                </div>
            </section>


            <section>
                <div class="down-30 center larger">
                    è®©ä½ çš„è‘«èŠ¦å¨ƒä»¬æŠ–åŠ¨èµ·æ¥ï¼
                </div>
            </section>
        </div>
    </div>
</body>
</head>

</html>